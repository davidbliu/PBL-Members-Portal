
<style type = 'text/css'>
.show-card{
	padding:15px;
	padding-top:0px;
	margin:15px;
}
.groups-form{
	display:none;
}
.groups-toggle:hover{
	cursor:pointer;
	opacity:0.5;
}
</style>

<div class = 'show-card'>

	<div>
		Key
		<input type = 'text' class = 'form-control' placeholder = 'key' id = 'key-input' value = '<%= @golink.key %>'>
	</div>

	<div>
		URL
		<input type = 'text' class = 'form-control' placeholder = 'url' id = 'url-input' value = '<%= @golink.url %>'>
	</div>

	<div>
		Description
		<input type = 'text' class = 'form-control' placeholder = 'description' id = 'description-input' value = '<%= @golink.description %>'>
	</div>

	<div>
		Creator: <%= @golink.member_email %>
	</div>

	<div class = 'groups-edit' data-id = '<%= @golink.id %>'>
		<div class = 'groups-toggle'>
			Shared With: <%= @golink.groups %>
		</div>
		<div class = 'groups-form'>
			<% @groups.each do |group| %>
			<div>
				<% if @golink.get_groups.include?(group.key) %>
					<input class = 'group-checkbox' type = 'checkbox' data-key = '<%= group.key %>' checked>
				<% else %>
					<input class = 'group-checkbox' type = 'checkbox' data-key = '<%= group.key %>'>
				<% end %>
				<%= link_to group.get_name, "#" %>
			</div>
			<% end %>
		</div>
	</div>
	<div class = 'btn btn-info' id = 'save-btn'>Save</div>
	<div class = 'btn btn-danger' id = 'delete-btn'>Delete</div>
</div>

<script type = 'text/javascript'>

$('.groups-toggle').click(function(){
	$('.groups-form').each(function(){
		$(this).toggle();
	})
});

function getGroupsChecked(){
	var checked = [];
	$('.group-checkbox').each(function(){
		if($(this).is(':checked')){
			checked.push($(this).attr('data-key'));
		}
	});
	return checked;
}
$('#save-btn').click(function(){
	$.ajax({
		url: '/go/update',
		type:'post',
		data:{
			id: <%= @golink.id %>,
			url: $('#url-input').val(),
			description: $('#description-input').val(),
			key: $('#key-input').val(),
			groups: getGroupsChecked()
		},
		success:function(data){
			window.location.reload();
		}
	})
});
$('#delete-btn').click(function(){
	$.ajax({
		url: '/go/destroy',
		type:'post',
		data:{
			id: <%= @golink.id %>
		},
		success:function(data){
			window.location.reload();
		}
	})
});
</script>